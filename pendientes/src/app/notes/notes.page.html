<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <div class="iontoolbar">
      <ion-title>Notas</ion-title>
      <ion-searchbar [(ngModel)]="searchTerm" placeholder="Buscar"></ion-searchbar>
      <ion-button (click)="toggleView()">
        <ion-icon [name]="isGridView ? 'list' : 'grid'"></ion-icon>
      </ion-button>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-fab vertical="bottom" slot="fixed" class="reports">
    <ion-fab-button (click)="goToReportPage()">
      <ion-icon name="document-text"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openAddNoteModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-list>
    <ion-grid>
      <ion-row>
        <ion-col *ngFor="let note of filterNotes(); let i = index" [size]="isGridView ? '6' : '12'">
          <ion-card [color]="note.color" (click)="openViewNoteModal(note)" class="note-card">
            <ion-card-header>
              <ion-card-title>{{ note.title }}</ion-card-title>
            </ion-card-header>
            <ion-card-content class="note-card-content">
              <p>{{ note.description }}</p>
              <img *ngIf="note.imageUrl" [src]="note.imageUrl" class="note-image">
              <div class="note-buttons">
                <ion-button fill="clear" color="danger" (click)="deleteNoteWithEvent(i, $event)">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>
                </ion-button>
                <ion-button fill="clear" color="primary" (click)="editNoteWithEvent(i, $event)">
                  <ion-icon slot="icon-only" name="create"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-list>
</ion-content>

<!-- Crear nota -->
<ion-modal [isOpen]="isModalOpen" (willDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{ isEditing ? 'Editar Nota' : 'Agregar Nota' }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <form (ngSubmit)="addNote()">
        <ion-item>
          <ion-label position="floating">Título</ion-label>
          <ion-input type="text" [(ngModel)]="newNote.title" name="title" required></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea [(ngModel)]="newNote.description" name="description" required></ion-textarea>
        </ion-item>
        <ion-item>
          <input type="file" (change)="onFileSelected($event)" accept="image/*">
          <img *ngIf="selectedFileUrl" [src]="selectedFileUrl" class="selected-image">
          <ion-button *ngIf="selectedFileUrl" (click)="removeImage()" color="danger">
            <ion-icon slot="icon-only" name="close-circle"></ion-icon>
          </ion-button>
        </ion-item>
        <ion-item>
          <ion-label>Color</ion-label>
          <ion-select [(ngModel)]="newNote.color" name="color">
            <ion-select-option value="primary">Azul</ion-select-option>
            <ion-select-option value="secondary">Gris</ion-select-option>
            <ion-select-option value="tertiary">Verde</ion-select-option>
            <ion-select-option value="success">Verde Claro</ion-select-option>
            <ion-select-option value="warning">Amarillo</ion-select-option>
            <ion-select-option value="danger">Rojo</ion-select-option>
            <ion-select-option value="dark">Negro</ion-select-option>
            <ion-select-option value="white">Blanco</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-button expand="full" type="submit">{{ isEditing ? 'Guardar Cambios' : 'Agregar Nota' }}</ion-button>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal para ver nota -->
<ion-modal [isOpen]="isViewModalOpen" (willDismiss)="closeViewModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Ver Nota</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeViewModal()">Cerrar</ion-button>
        </ion-buttons>
        <ion-buttons slot="start">
          <ion-button (click)="openShareModal()">
            <ion-icon name="share-alt" class="share"></ion-icon>
          </ion-button>

          <ion-buttons slot="start">
            <ion-button (click)="openShareModal()">
              <ion-icon name="share-outline"></ion-icon>
            </ion-button>
          </ion-buttons>

        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-item>
        <ion-text>{{ selectedNote?.title }}</ion-text>
      </ion-item>
      <ion-item>
        <ion-text>{{ selectedNote?.description }}</ion-text>
      </ion-item>
      <ion-item *ngIf="selectedNote?.imageUrl">
        <ion-img [src]="selectedNote?.imageUrl"></ion-img>
      </ion-item>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Modal para opciones de compartir -->
<ion-modal [isOpen]="isShareModalOpen" (willDismiss)="closeShareModal()" class="share-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Compartir datos</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content>
      <ion-item (click)="shareAsText()">
        <img src="../../assets/txt-svgrepo-com.svg" alt="text Icon" />
        <span>Compartir Texto</span>
      </ion-item>
      <ion-item (click)="shareAsPdf()">
        <img src="../../assets/pdf-svgrepo-com.svg" alt="PDF Icon" />
        <span>Compartir como PDF</span>
      </ion-item>
      <ion-item (click)="shareAstexto()">
        <img src="../../assets/txt-svgrepo-com.svg" alt="txt Icon" />
        <span>Compartir como archivo de texto .txt</span>
      </ion-item>
      <ion-item (click)="shareAsImage()">
        <img src="../../assets/picture-svgrepo-com.svg" alt="img Icon" />
        <span>Compartir Imagen</span>
      </ion-item>
    </ion-content>
  </ng-template>
</ion-modal>



